<!DOCTYPE html>
<html>
  <head>
     
    <meta charset="UTF-8">
    <title>N100åŒç½‘å£å°ä¸»æœºä½¿ç”¨dockerç‰ˆopenwrtåšä¸»è·¯ç”±ï¼ˆPPPoEæ‹¨å·ï¼‰è¶…è¯¦ç»†ï¼ï¼ï¼ï¼ - qllokirin</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta property="og:site_name" content="qllokirin">
    <meta property="og:title" content="N100åŒç½‘å£å°ä¸»æœºä½¿ç”¨dockerç‰ˆopenwrtåšä¸»è·¯ç”±ï¼ˆPPPoEæ‹¨å·ï¼‰è¶…è¯¦ç»†ï¼ï¼ï¼ï¼"/>
    
<meta name="generator" content="Hexo 6.3.0"></head>

  <body>
    <header>
    <div class="head-title">
        <h4>qllokirin</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="æœç´¢ä»€ä¹ˆï¼Ÿ">
    </form>
    <nav class="head-menu">
        <a href="/">é¦–é¡µ</a>
        <div class="has-child">
            <a>åˆ†ç±»</a>
            <div class="sub-menu">
                <a class="category-link" href="/categories/%E5%88%86%E4%BA%AB/">åˆ†äº«</a><a class="category-link" href="/categories/%E6%95%99%E7%A8%8B/">æ•™ç¨‹</a><a class="category-link" href="/categories/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a><a class="category-link" href="/categories/%E8%AE%B0%E5%BD%95/">è®°å½•</a>
            </div>
        </div>
        
            <a href="/about">å…³äºæˆ‘</a>
        
            <a href="/friends">æœ‹å‹ä»¬</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>N100åŒç½‘å£å°ä¸»æœºä½¿ç”¨dockerç‰ˆopenwrtåšä¸»è·¯ç”±ï¼ˆPPPoEæ‹¨å·ï¼‰è¶…è¯¦ç»†ï¼ï¼ï¼ï¼</h2>
            <div class="post-meta">
                <time class="date">2024.04.11</time>
            
                <span class="category"><a class="category-link" href="/categories/%E6%95%99%E7%A8%8B/">æ•™ç¨‹</a></span>
            
            </div>
        </section>
        <article class="post-content">
        
            <p>è¸©äº†å¥½å¤šå¥½å¤šå¤§å‘ï¼Œæ„Ÿè§‰ç”¨N100åœ¨dockerä¸­ä½¿ç”¨openwrtå¹¶ä¸”WANå£è¿›è¡ŒPPPoEæ‹¨å·çš„æ•™ç¨‹ä¸æ˜¯å¤ªå¤šï¼Œç»™æˆ‘æŠ˜ç£¨å®Œäº†</p>
<span id="more"></span>

<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘å…¥æ‰‹äº†ä¸€ä¸ª 699 åŒç½‘å£çš„ N100 å°ä¸»æœºï¼Œè‡ªå·±æœ‰å†…å­˜å’Œç¡¬ç›˜ï¼Œè£…ä¸Šå°±å¼€å§‹é…·é…·æ¯é¥¬ï¼Œè£…ä¸Š Ubuntu22.04ï¼ŒåŒç½‘å£çš„ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ openwrtï¼Œå¯åŠ¨ï¼</p>
<p>ç›¸åŒæƒ…å†µçš„æ•™ç¨‹çš„ç¡®æœ‰ç‚¹å°‘ï¼Œé…·é…·è¸©å‘ï¼Œæ„Ÿè§‰å¯èƒ½æ˜¯æ²¡äººç”¨ docker openwrt å½“ä¸»è·¯ç”±ï¼Œè€Œä¸” WAN å£è¿˜æ˜¯ PPPoE æ‹¨å·</p>
<p>å…ˆç½—åˆ—ä¸€ä¸‹å‚è€ƒè¿‡çš„æ•™ç¨‹</p>
<p><strong>èƒ½ç”¨ï¼Œå¥½ç”¨çš„æ•™ç¨‹</strong></p>
<ul>
<li><p><input checked="" disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://rupu.net/archives/docker-openwrt">https://rupu.net/archives/docker-openwrt</a></p>
<blockquote>
<p>ç¥ä¸­ç¥ï¼Œä¸»è·¯ç”±ä¸”åŒç½‘å¡ï¼Œä¸åŒä¹‹å¤„æ˜¯æˆ‘æ˜¯PPPoEæ‹¨å·ä¸Šç½‘ä¸”ä»–çš„lanå£æ˜¯<strong>æ— çº¿ç½‘å¡</strong>ï¼ˆè¿™ä¸ªå¾ˆé‡è¦ï¼Œæœ‰ä¸ªå¤§å‘ï¼‰</p>
</blockquote>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38251691/article/details/128356619">https://blog.csdn.net/qq_38251691/article/details/128356619</a></p>
<blockquote>
<p>ç¥ï¼Œ<strong>ä¸€å®šéœ€è¦æ‰‹åŠ¨è®¾ç½® ip åœ°å€å’Œç½‘å…³</strong>ï¼Œå‚è€ƒä¸€äº›æ•™ç¨‹ä¼šè®¾ç½®ä¸º.x.2å®³æ­»æˆ‘äº†ï¼Œç¬¬ä¸€æ¬¡è¿æ¥IPã€å­ç½‘æ©ç ã€ç½‘å…³çš„é™æ€è®¾ç½®éå¸¸é‡è¦ï¼Œå› ä¸ºé•œåƒçš„LANå£é»˜è®¤ä¸ä¼šå¼€å¯DHCPï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®é™æ€IPè¿›å…¥openwrtåå°åå¼€å¯DHCP</p>
</blockquote>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://blog.csdn.net/gongchenyu/article/details/134724333">https://blog.csdn.net/gongchenyu/article/details/134724333</a></p>
<blockquote>
<p>dockeræ—è·¯ç”±ï¼Œæœ‰å‚è€ƒä»·å€¼ï¼Œæœ‰å®¿ä¸»æœºé€šä¿¡</p>
</blockquote>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://rehtt.com/index.php/archives/236/">https://rehtt.com/index.php/archives/236/</a></p>
<blockquote>
<p>å®¿ä¸»æœºé€šä¿¡è¯¦è§£ï¼Œéå¸¸çš„æ£’</p>
</blockquote>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/awzodmpp/">https://post.smzdm.com/p/awzodmpp/</a></p>
<blockquote>
<p>IPV6è®¾ç½®ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<a target="_blank" rel="noopener" href="https://github.com/SuLingGG/OpenWrt-Rpi">ImmortalWrt</a>ï¼ŒWAN6é€‰è®¾å¤‡çš„æ—¶å€™æ²¡æœ‰@WANæˆ–è€…pppoe-WANï¼Œä½†å…¶å®å¯ä»¥ç›´æ¥åœ¨æ–‡ä»¶é‡Œé¢æ”¹</p>
</blockquote>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://github.com/lisaac/blog/issues/4#issuecomment-603069862">https://github.com/lisaac/blog/issues/4#issuecomment-603069862</a></p>
<blockquote>
<p>ä¸‰ç½‘å£ï¼ˆå¡ï¼‰åŠä»¥ä¸Šéœ€è¦æ³¨æ„é¡ºåº</p>
</blockquote>
</li>
</ul>
<p><strong>ä¸æˆ‘æƒ…å†µä¸åŒ</strong></p>
<ul>
<li><p><input disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://zhwebsite.com/2024/01/28/%E5%9F%BA%E4%BA%8Edebian-12%EF%BC%8C%E5%88%A9%E7%94%A8docker%E7%9A%84openwrt%E6%90%AD%E5%BB%BA/">https://zhwebsite.com/2024/01/28/%E5%9F%BA%E4%BA%8Edebian-12%EF%BC%8C%E5%88%A9%E7%94%A8docker%E7%9A%84openwrt%E6%90%AD%E5%BB%BA/</a></p>
<blockquote>
<p>æ˜¯N100åŒç½‘å£ä½†æ˜¯æŒ‡ä»¤æœ‰é—®é¢˜ä½†æœªæåŠå®¿ä¸»æœºé€šä¿¡é—®é¢˜ï¼Œä¸”ç½‘å…³çš„æŒ‡ä»¤éƒ½ä¼šæŠ¥é”™ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘Ubuntu22.04è¦æ±‚å¿…é¡».x.0ï¼‰</p>
</blockquote>
<p>æ—è·¯ç”±ï¼š</p>
<ul>
<li><p><input disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://zy.hn/2023/02/23/deploy-openwrt-with-docker/">https://zy.hn/2023/02/23/deploy-openwrt-with-docker/</a></p>
</li>
<li><p><input disabled="" type="checkbox"> 
<a target="_blank" rel="noopener" href="https://openwrt.ai/docker%E7%89%88openwrt%E6%97%81%E8%B7%AF%E7%94%B1%E5%AE%89%E8%A3%85%E8%AE%BE%E7%BD%AE%E6%95%99%E7%A8%8B/">https://openwrt.ai/docker%E7%89%88openwrt%E6%97%81%E8%B7%AF%E7%94%B1%E5%AE%89%E8%A3%85%E8%AE%BE%E7%BD%AE%E6%95%99%E7%A8%8B/</a></p>
<p>ï¼ˆè™½ç„¶è¿™ä¸ªç½‘ç«™çš„é•œåƒæ„å»ºå¾ˆå¥½ç”¨ï¼Œä½†æ˜¯è¿™ç¯‡æ•™ç¨‹æŒ‡ä»¤éƒ½æœ‰é—®é¢˜ï¼‰</p>
</li>
</ul>
</li>
</ul>
<h1 id="é•œåƒé€‰æ‹©"><a href="#é•œåƒé€‰æ‹©" class="headerlink" title="é•œåƒé€‰æ‹©"></a>é•œåƒé€‰æ‹©</h1><p><strong>1.ä¸‹è½½é•œåƒåå¯¼å…¥</strong></p>
<p>å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://archive.openwrt.org/releases/23.05.3/targets/">https://archive.openwrt.org/releases/23.05.3/targets/</a></p>
<p>èµ„æºç«™ï¼š<a target="_blank" rel="noopener" href="https://github.com/kiddin9/openwrt-packages">https://github.com/kiddin9/openwrt-packages</a></p>
<p>èµ„æºç«™ï¼š<a href="https://openwrt.ai/?target=x86/64&id=generic%EF%BC%88%E6%9C%80%E4%B8%8B%E9%9D%A2%EF%BC%89">https://openwrt.ai/?target=x86%2F64&amp;id=genericï¼ˆæœ€ä¸‹é¢ï¼‰</a></p>
<blockquote>
<p>é€‰<code>xxx-rootfs.tar.gz</code>ï¼Œæ˜¯å¯è§£å‹å›ºä»¶,ä¸€èˆ¬ç”¨äºDocker</p>
<pre><code>gunzip xxx-rootfs.tar.gz
docker xxx-rootfs.tar openwrt:rootfs
</code></pre>
<p>å¦‚ <a target="_blank" rel="noopener" href="https://archive.openwrt.org/releases/23.05.3/targets/x86/64/openwrt-23.05.3-x86-64-rootfs.tar.gz">https://archive.openwrt.org/releases/23.05.3/targets/x86/64/openwrt-23.05.3-x86-64-rootfs.tar.gz</a></p>
</blockquote>
<p><strong>2.dockeré•œåƒæ‹‰å–</strong></p>
<p><code>docker pull sulinggg/openwrt:x86_64</code>ï¼Œè¿™ä¸ªé•œåƒè™½ç„¶ä¸ç»´æŠ¤äº†ä½†æ˜¯è¿˜æ˜¯å¾ˆæ£’ï¼Œé¢„è£…äº†å¾ˆå¤šæ’ä»¶ï¼Œæœ¬æ•™ç¨‹ä½¿ç”¨è¿™ä¸ªè¿›è¡Œæ¼”ç¤º</p>
<p><strong>3.è‡ªå·±ç¼–è¯‘</strong></p>
<h1 id="OP-å¯åŠ¨ï¼"><a href="#OP-å¯åŠ¨ï¼" class="headerlink" title="OP å¯åŠ¨ï¼"></a>OP å¯åŠ¨ï¼</h1><h3 id="ä¸€ã€å¼€å¯ç½‘å£æ··æ‚æ¨¡å¼"><a href="#ä¸€ã€å¼€å¯ç½‘å£æ··æ‚æ¨¡å¼" class="headerlink" title="ä¸€ã€å¼€å¯ç½‘å£æ··æ‚æ¨¡å¼"></a>ä¸€ã€å¼€å¯ç½‘å£æ··æ‚æ¨¡å¼</h3><p><strong>1.æŸ¥çœ‹ç½‘å£åå­—</strong></p>
<pre><code>âœ  ~ ifconfig
enp2s0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet6 fe80::c07f:75dc:901a:49b6  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:e0:4c:08:6a:4f  txqueuelen 1000  (ä»¥å¤ªç½‘)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 38  bytes 6249 (6.2 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
        device memory 0x80c00000-80cfffff  

enp4s0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet6 fe80::6bb:2302:767e:7b3d  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 00:e0:4c:08:6a:50  txqueuelen 1000  (ä»¥å¤ªç½‘)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 35  bytes 5650 (5.6 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
        device memory 0x80900000-809fffff  

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 1000  (æœ¬åœ°ç¯å›)
        RX packets 474  bytes 36598 (36.5 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 474  bytes 36598 (36.5 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

wlp1s0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        ether f8:89:d2:69:42:df  txqueuelen 1000  (ä»¥å¤ªç½‘)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre>
<p>å¦‚ä¸Šï¼Œæˆ‘çš„ç½‘å£æ˜¯<code>enp2s0</code>å’Œ<code>enp4s0</code>ï¼Œ<code>wlp1s0</code>æ˜¯æ— çº¿ç½‘å¡ï¼Œå…ˆä¸ç®¡</p>
<p>æˆ‘è¿™é‡Œé€‰æ‹©<code>enp2s0</code>æ˜¯LANå£è´Ÿè´£æœ¬åœ°åˆ†æ´¾IPï¼Œ<code>enp4s0</code>ä¸ºWANå£è´Ÿè´£æ‹¨å·ä¸Šç½‘</p>
<p><strong>2.å¼€å¯ç½‘å£æ··æ‚</strong></p>
<pre><code>sudo ip link set enp4s0 promisc on
sudo ip link set enp2s0 promisc on
</code></pre>
<p>ç„¶åä¸Šé¢çš„<code>ifconfig</code>è¾“å‡ºåé¢ä¼šæ–°å¢<code>PROMISC</code>å­—æ®µï¼Œå°±æ˜¯å¼€å¯æˆåŠŸ</p>
<pre><code>enp2s0: flags=4419&lt;UP,BROADCAST,RUNNING,PROMISC,MULTICAST&gt;  mtu 1500
enp4s0: flags=4419&lt;UP,BROADCAST,RUNNING,PROMISC,MULTICAST&gt;  mtu 1500
</code></pre>
<p><strong>3.å¼€æœºè‡ªè‡ªåŠ¨</strong></p>
<p>ä¸€é‡å¯ç½‘å£æ··æ‚å°±ä¼šæ¶ˆå¤±ï¼Œæ‰€ä»¥éœ€è¦å†™è¿›å¼€æœºè„šæœ¬ï¼Œè¿™é‡Œæˆ‘ç”¨<code>systemctl</code>å®ç°</p>
<p>å…ˆå†™è„šæœ¬ï¼Œ<code>vim /home/&#123;your_name&#125;/sh/network_op.sh</code>ï¼Œå†™å…¥ä¸‹é¢çš„å†…å®¹ï¼Œ<strong>your_name</strong>æ›¿æ¢æˆä½ çš„</p>
<pre><code>sudo ip link set enp4s0 promisc on
sudo ip link set enp2s0 promisc on
</code></pre>
<p>å†æ–°å»ºsystemï¼Œ<code>sudo vim /etc/systemd/system/network_op.service</code>ï¼Œå†™å…¥ä¸‹é¢çš„å†…å®¹ï¼Œ<strong>your_name</strong>æ›¿æ¢æˆä½ çš„</p>
<pre><code>[Unit]
Description=Enable op network

[Service]
Type=oneshot
ExecStart=/usr/bin/sh /home/&#123;your_name&#125;/sh/network_op.sh
User=root
Group=root

[Install]
WantedBy=multi-user.target
</code></pre>
<p>è¿è¡Œä¸€æ¬¡æœåŠ¡å¹¶è®¾ç½®å¼€å¯è‡ªå¯åŠ¨</p>
<pre><code>sudo systemctl start network_op
sudo systemctl enable network_op
</code></pre>
<h3 id="äºŒã€åˆ›å»ºç½‘ç»œå¹¶å¯åŠ¨OP"><a href="#äºŒã€åˆ›å»ºç½‘ç»œå¹¶å¯åŠ¨OP" class="headerlink" title="äºŒã€åˆ›å»ºç½‘ç»œå¹¶å¯åŠ¨OP"></a>äºŒã€åˆ›å»ºç½‘ç»œå¹¶å¯åŠ¨OP</h3><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ docker çš„ macvlanï¼Œä»ç‰©ç†ç½‘å£è™šæ‹Ÿå‡ºä¸€ä¸ªæ–°çš„ç½‘å£ï¼Œå¹¶ä¸”æŒ‚è½½è¿› openwrt é•œåƒä¸­</p>
<pre><code># åˆ›å»º LAN å£è™šæ‹Ÿç½‘ç»œï¼ŒæŒ‡å®šç½‘æ®µä¸º 100.xï¼Œç½‘å…³æ˜¯ 100.1ï¼Œè®¾å¤‡ä½¿ç”¨ enp2s0ï¼Œåå­—å« op_lan
# ï¼ˆå¦‚æœè¦ä¿®æ”¹åå­—è¯·çœ‹å®Œä¸Šé¢çš„ã€Šä¸‰ç½‘å£ï¼ˆå¡ï¼‰åŠä»¥ä¸Šéœ€è¦æ³¨æ„é¡ºåºã€‹ï¼‰
docker network create -d macvlan --subnet=192.168.100.0/24 --gateway=192.168.100.1 -o parent=enp2s0 op_lan
# åˆ›å»º WAN å£ç½‘ç»œï¼Œæˆ‘æ˜¯ PPPoE æ‹¨å·æ‰€ä»¥ç½‘å…³ç½‘æ®µä»€ä¹ˆçš„éƒ½ä¸æŒ‡å®šäº†
docker network create -d macvlan -o parent=enp4s0 op_wan
# å¯åŠ¨ docker openwrtï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ sulinggg/openwrt:x86_64 é•œåƒï¼Œè®¾ç½®è‡ªå¯åŠ¨ï¼Œåå­—å« openwrtï¼ŒæŠŠ op_lan è¿æ¥è¿›å»
# æœ‰äº›æ•™ç¨‹ä¼šåœ¨è¿™é‡ŒåŠ ä¸Š --ip ç›´æ¥è®¾ç½®æˆ .100.2ï¼Œä½†æˆ‘æ„Ÿè§‰ op å°±æ˜¯ç½‘å…³ï¼Œæ‰€ä»¥è¿™é‡Œä¸æŒ‡å®šï¼Œç›´æ¥åœ¨ op é‡Œé¢è®¾ç½®ï¼Œå ä½ 100.1çš„ ip
docker run --restart always --name openwrt -d --network op_lan --privileged sulinggg/openwrt:x86_64 /sbin/init
# å†æŠŠ op_wan ä¹Ÿè¿æ¥è¿›å»
docker network connect op_wan openwrt
</code></pre>
<p>å®é™…è¿‡ç¨‹</p>
<pre><code>(base) âœ  python_and_sh docker network create -d macvlan --subnet=192.168.100.0/24 --gateway=192.168.100.1 -o parent=enp2s0 op_lan
e5c68630a0198f2985a7313c68dbcae0165a60b867e8efa6b9694fb39cc42ed2
(base) âœ  python_and_sh docker network create -d macvlan -o parent=enp4s0 op_wan
d284f0d8cde3ac57faae92ab2f2739b4aace7064f7f5bf0556077e51785969e2
(base) âœ  python_and_sh docker run --restart always --name openwrt -d --network op_lan --privileged sulinggg/openwrt:x86_64 /sbin/init
bbe19438aa00be18e2feb1d38ca860a7eeb42e90b756ebaf393f4ce11c7ceac6
(base) âœ  python_and_sh docker network connect op_wan openwrt
(base) âœ  python_and_sh docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
97dae32aa936   bridge    bridge    local
5fca31148366   host      host      local
07b5461851d7   none      null      local
e5c68630a019   op_lan    macvlan   local
d284f0d8cde3   op_wan    macvlan   local
(base) âœ  python_and_sh docker ps -a     
CONTAINER ID   IMAGE                     COMMAND        CREATED          STATUS          PORTS     NAMES
bbe19438aa00   sulinggg/openwrt:x86_64   &quot;/sbin/init&quot;   13 seconds ago   Up 12 seconds             openwrt
</code></pre>
<h3 id="ä¸‰ã€é…ç½®LAN-amp-WANç½‘ç»œ"><a href="#ä¸‰ã€é…ç½®LAN-amp-WANç½‘ç»œ" class="headerlink" title="ä¸‰ã€é…ç½®LAN&amp;WANç½‘ç»œ"></a>ä¸‰ã€é…ç½®LAN&amp;WANç½‘ç»œ</h3><p>æ¥ä¸‹æ¥è¦è¿›å…¥å®¹å™¨å†…ä¿®æ”¹é…ç½®</p>
<pre><code># è¿›å…¥openwrté•œåƒå†…éƒ¨
docker exec -it openwrt bash
vim /etc/config/network
</code></pre>
<p>æŠŠ lan æ”¹ä¸ºä¸‹é¢çš„å‚æ•°ï¼Œåˆ æ‰å¤šä½™çš„å­—æ®µ</p>
<pre><code>config interface &#39;lan&#39;
        option type &#39;bridge&#39;
        option ifname &#39;eth0&#39;
        option proto &#39;static&#39;
        option netmask &#39;255.255.255.0&#39;
        option ip6assign &#39;60&#39;
        option ipaddr &#39;192.168.100.1&#39;
</code></pre>
<p>é‡å¯ç½‘ç»œ</p>
<pre><code>/etc/init.d/network restart
</code></pre>
<p><strong>ï¼ï¼ï¼ï¼ï¼ç„¶åç¬¬ä¸€ä¸ªå°å‘ï¼Œå›ºä»¶é»˜è®¤ lan å£ä¸å¼€å¯ DHCPï¼Œæ‰€ä»¥æ’ä¸Š lan å£éœ€è¦è‡ªè¡Œè®¾å®š IP å’Œç½‘å…³ï¼ï¼ï¼ï¼ï¼</strong></p>
<p><img src="https://s2.loli.net/2024/04/11/ovJMdKpPZEuaz5x.png" alt="1.png"></p>
<p>ç„¶åæµè§ˆå™¨è¾“å…¥<code>192.168.100.1</code>å³å¯è¿›å…¥ openwrt çš„åå°ç®¡ç†é¡µé¢</p>
<blockquote>
<p>è¿™ä¹ˆè¯´èµ·æ¥æˆ‘å½“æ—¶ç›´æ¥è¾“äº†æˆ‘è‡ªå·±å¯†ç å°±ç™»è¿›å»äº†ï¼Œéš¾é“ä»–æ˜¯è‡ªåŠ¨æŠŠç¬¬ä¸€æ¬¡è¾“å…¥çš„å¯†ç å½“å¯†ç ï¼Ÿå¦‚æœæ²¡æœ‰çš„è¯å°±è¯•è¯•rootã€passã€passwordä»€ä¹ˆçš„</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆæŠŠ <strong>lan å£ DHCP æ‰“å¼€</strong>ï¼Œç½‘ç»œ-&gt;æ¥å£-&gt;lan-&gt;ä¿®æ”¹-&gt;æœ€ä¸‹é¢-&gt;å¿½ç•¥æ­¤æ¥å£-&gt;<code>å–æ¶ˆå‹¾é€‰</code>ï¼Œé«˜çº§è®¾ç½®-&gt;<code>å¼ºåˆ¶</code>ä¹Ÿå‹¾é€‰ä¸Šï¼Œ<code>ä¿å­˜&amp;åº”ç”¨</code></p>
<p><code>ç½‘ç»œ</code>-&gt;DHCP&#x2F;DNS-&gt;åŸºæœ¬è®¾ç½®-&gt;å–æ¶ˆå‹¾é€‰<code>é‡ç»‘å®šä¿æŠ¤</code>ï¼Œ<strong>ä¸ç„¶ä¸€äº›åŸŸåè§£æçš„ç»“æ„æ˜¯<code>192.x</code>å’Œ<code>10.x</code>çš„ä¿ç•™åœ°å€ä¸ä¼šè¢«è¿”å›ï¼ï¼ï¼ï¼ï¼ï¼</strong><code>ä»…æœ¬åœ°æœåŠ¡ä¸š</code>ä¹Ÿå¯ä»¥å…³äº†</p>
<p>å†<strong>é…ç½® wan å£</strong>ï¼Œæ·»åŠ æ–°æ¥å£</p>
<p><img src="https://s2.loli.net/2024/04/11/7lruCSX6k3WsJKM.png" alt="2.png"></p>
<p>å¡«å…¥è´¦å·å’Œå¯†ç  <strong>ï¼ï¼ï¼ï¼åœ¨ wan çš„é˜²ç«å¢™è®¾ç½® é€‰ä¸­ wanï¼ï¼ï¼ï¼</strong>ï¼Œä¸ç„¶ä¸€åˆ‡ç«¯å£è½¬å‘éƒ½ä¼šå¤±æ•ˆ</p>
<blockquote>
<p>æœ‰æ—¶å€™ä¼šè‡ªåŠ¨é€‰ä¸­ ä½†æœ‰æ—¶å€™ä¸ä¼š</p>
</blockquote>
<p>å¦‚æœå¡ä½å¯ä»¥é‡å¯dockerï¼Œ<code>docker restart openwrt</code></p>
<p>è¿™æ—¶å€™ wan å£å¯ä»¥æ­£å¸¸æ‹¨å·è·å¾— IPï¼ŒLAN å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é… ip äº†ï¼Œä½†æ˜¯ï¼Œ<strong>å®¿ä¸»æœºæ˜¯æ— æ³•ä½¿ç”¨ç½‘ç»œ</strong>ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®¿ä¸»æœºä¹Ÿåˆ†é…ä¸€ä¸ª<code>192.168.100.x</code>çš„åœ°å€</p>
<h3 id="å››ã€å®¿ä¸»æœºä½¿ç”¨-openwrt-çš„ç½‘ç»œ"><a href="#å››ã€å®¿ä¸»æœºä½¿ç”¨-openwrt-çš„ç½‘ç»œ" class="headerlink" title="å››ã€å®¿ä¸»æœºä½¿ç”¨ openwrt çš„ç½‘ç»œ"></a>å››ã€å®¿ä¸»æœºä½¿ç”¨ openwrt çš„ç½‘ç»œ</h3><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ ip æŒ‡ä»¤ç»™ç½‘å¡åˆ›å»º macvlanï¼Œå› ä¸º macvlan çš„å®‰å…¨æœºåˆ¶ï¼Œå®¿ä¸»æœºä¸å®¹å™¨å†…ä¸èƒ½é€šè¿‡ macvlan æ•°æ®äº’é€šï¼Œä½†æ˜¯ macvlan ä¹‹é—´å¯ä»¥äº’é€š</p>
<pre><code># å…ˆåˆ›å»ºä¸€ä¸ªåå« me_to_op çš„ macvlanï¼Œä½¿ç”¨è®¾å¤‡ enp2s0
sudo ip link add me_to_op link enp2s0 type macvlan mode bridge
# æŠŠå®¿ä¸»æœºçš„ ip è®¾ç½®ä¸º 192.168.100.100
sudo ip addr add 192.168.100.100 dev me_to_op
# å¯åŠ¨ me_to_op
sudo ip link set me_to_op up
# æ·»åŠ è·¯ç”±
sudo ip route add 192.168.100.1 dev me_to_op
# ä¿®æ”¹é»˜è®¤è·¯ç”±
sudo route add default gw 192.168.100.1 me_to_op
</code></pre>
<p>é…ç½®å®Œæˆä¹‹åå°±å¯ä»¥äº’ç›¸ ping</p>
<p><strong>å®¿ä¸»æœºåˆ° openwrt</strong>ï¼š<code>ping 192.168.100.1</code></p>
<p><strong>openwrt åˆ°å®¿ä¸»æœº</strong>ï¼š<code>docker exec -it openwrt bash -c &quot;ping 192.168.100.100 -c 3&quot;</code></p>
<p>è¿™æ—¶å€™è·¯ç”±æ­£ç¡®ï¼ˆ<code>route -n</code>ï¼‰ä½†æ˜¯<strong>åŸŸåè§£æä¸å¯¹</strong>ï¼Œèƒ½ ping ip ä½†æ˜¯ä¸èƒ½ä¸Šç½‘ï¼Œæˆ‘ä»¬æ¥ç€é…ç½® DNS</p>
<pre><code>sudo sh -c &#39;echo &quot;nameserver 192.168.100.1&quot; &gt; /etc/resolv.conf&#39;
</code></pre>
<blockquote>
<p>æ”¹<code> /etc/systemd/resolved.conf</code>çš„ dns å­—æ®µæ˜¯æ›´åŠ è§„èŒƒçš„æ“ä½œï¼Œä½†æ˜¯æ€•ä»¥åæ¢ç½‘ç»œç¯å¢ƒå¿˜è®°äº†ï¼Œæ‰€ä»¥ç›´æ¥æ”¹<code>/etc/resolv.conf</code></p>
</blockquote>
<p>å®¿ä¸»æœºè”ç½‘æµ‹è¯•ï¼š<code>curl baidu.com</code></p>
<pre><code>(base) âœ  ~ curl www.baidu.com
&lt;!DOCTYPE html&gt;
&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=http://........................
</code></pre>
<p>ä¸ºäº†ä½¿ä¸Šé¢çš„ä¿®æ”¹é‡å¯åä¸€ç›´ç”Ÿæ•ˆï¼Œä¿®æ”¹<code>/home/&#123;your_name&#125;/sh/network_op.sh</code>æ–‡ä»¶ä¸ºå¦‚ä¸‹å†…å®¹</p>
<pre><code>sudo ip link set enp4s0 promisc on
sudo ip link set enp2s0 promisc on

sudo ip link add me_to_op link enp2s0 type macvlan mode bridge
sudo ip addr add 192.168.100.100 dev me_to_op
sudo ip link set me_to_op up
sudo ip route add 192.168.100.1 dev me_to_op
sudo route add default gw 192.168.100.1 me_to_op

sudo sh -c &#39;echo &quot;nameserver 192.168.100.1&quot; &gt; /etc/resolv.conf&#39;
</code></pre>
<p><strong>Tipsï¼šä¸¤ä¸ªæ€ªé—®é¢˜</strong></p>
<ul>
<li><p>1.<strong>LAN å£ä¸æ’ä¸œè¥¿å®¿ä¸»æœºå°± ping ä¸é€š 192.168.100.1</strong>ï¼Œå°±æ˜¯è¿™ä¹ˆçš„ç¥å¥‡ï¼Œå¿…é¡»å¾—è¦ LAN å£æœ‰ä¸€ä¸ªè®¾å¤‡ï¼Œä¸ç„¶å°±æ˜¯ ping ä¸é€šï¼Œæˆ‘çš„ç†è§£æ˜¯ LAN å£ä¸æ’ä¸œè¥¿å°±æ²¡æœ‰è¢«æ¿€æ´»ï¼Œæ‰€ä»¥ä¸Šé¢è®¾ç½®çš„ macvlan æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ¯”å¦‚æ¥ä¸ªç”µè„‘æ˜¯å¯ä»¥çš„ï¼Œæ¥ä¸ªäº¤æ¢æœºï¼ˆäº¤æ¢æœºä¸æ¥å…¶ä»–ä¸œè¥¿ï¼‰ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªè¦ LAN å£ç¯äº®ç€å°±æ˜¯å¯ä»¥çš„ï¼Œæ²¡äº®å°±æ˜¯ä¸è¡Œçš„</p>
</li>
<li><p>2.<strong>LAN å£ä¸‹çš„ç½‘ç»œä¸èƒ½æ­£å¸¸è®¿é—®åŸŸåè§£æåˆ° WAN å£ IP ä¸Šçš„å†…å®¹</strong>ï¼Œå…·ä½“ç‚¹æ¥è¯´æ˜¯ï¼Œæˆ‘çš„ openwrt çš„ 80 ç«¯å£è½¬å‘åˆ°äº†å®¿ä¸»æœº<code>192.168.100.100</code>çš„ 80 ä¸Šï¼Œç„¶åç”± nginx åä»£ï¼Œ<code>op.xx.xx</code>ä»£ç†åˆ° op çš„ç®¡ç†é¡µé¢ï¼Œ<code>files.xx.xx</code>ä»£ç†åˆ° GoWebDav ä¸Šï¼Œè·Ÿ WAN å£åŒç½‘æ®µçš„<code>10.x.x.x.</code>çš„è®¾å¤‡å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯ LAN å£ä¸‹çš„è®¾å¤‡ç”¨åŸŸåä¸èƒ½è®¿é—®ï¼Œè€Œç›´æ¥ç«¯å£ + IP æ˜¯å¯ä»¥çš„ï¼Œéœ€è¦åšå¦‚ä¸‹æ”¹åŠ¨ï¼ˆæ˜¯ä¸æ¡¥æ¥ç½‘ç»œè¿‡æ»¤å™¨æœ‰å…³çš„å†…å®¹ï¼Œå…·ä½“åŸå› ä¸æ˜¯å¾ˆæ¸…æ¥šï¼‰</p>
<pre><code>1.sshè¿æ¥openwrtç³»ç»Ÿåï¼Œç¼–è¾‘/etc/sysctl.d/11-br-netfilter.confæ–‡ä»¶ã€‚
net.bridge.bridge-nf-call-arptables=0
net.bridge.bridge-nf-call-ip6tables=0
net.bridge.bridge-nf-call-iptables=0
ç¡®è®¤åé¢çš„å€¼æ˜¯0ï¼Œå¦‚æœä¸æ˜¯ï¼Œéœ€è¦æ”¹ä¸º0
2.ç¼–è¾‘/etc/sysctl.confæ–‡ä»¶ã€‚æ–‡ä»¶å†…å®¹å¯èƒ½æ˜¯ç©ºçš„ï¼ŒæŠŠä¸Šé¢çš„å†…å®¹å¤åˆ¶è¿›sysctl.confæ–‡ä»¶ï¼Œä¿å­˜é€€å‡ºã€‚
3.sshå†…è¾“å…¥sysctl -på‘½ä»¤ï¼ŒæŸ¥çœ‹è¾“å‡ºç»“æœæ˜¯ä¸æ˜¯ä¸Šé¢æåˆ°çš„é‚£ä¸‰è¡Œå†…å®¹ã€‚
4.é‡å¯
</code></pre>
</li>
</ul>
<blockquote>
<p>å‚è€ƒæ•™ç¨‹ï¼š<a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/forum.php?mod=redirect&goto=findpost&ptid=8192269&pid=16637078">https://www.right.com.cn/forum/forum.php?mod=redirect&amp;goto=findpost&amp;ptid=8192269&amp;pid=16637078</a></p>
<p>éƒ¨åˆ†æ•™ç¨‹æåŠäº† 80 ç«¯å£è½¬å‘çš„<code>NAT ç¯å›</code>ï¼Œ<strong>è¯·å‹¿å…³é—­</strong></p>
<pre><code>NATç¯å›ï¼ˆNAT loopbackï¼‰æ˜¯æŒ‡åœ¨ç½‘ç»œä¸­ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰æ—¶ï¼Œå½“å†…éƒ¨ä¸»æœºå°è¯•é€šè¿‡å…¶å¤–éƒ¨å…¬å…±IPåœ°å€è®¿é—®åœ¨åŒä¸€å†…éƒ¨ç½‘ç»œä¸­çš„å¦ä¸€å°ä¸»æœºæ—¶å‘ç”Ÿçš„æƒ…å†µã€‚ç®€å•æ¥è¯´ï¼Œå½“å†…éƒ¨ä¸»æœºè¯•å›¾é€šè¿‡å…¬å…±IPåœ°å€è®¿é—®è‡ªå·±æ‰€åœ¨çš„å†…éƒ¨ç½‘ç»œä¸­çš„å¦ä¸€å°ä¸»æœºæ—¶ï¼Œæ•°æ®åŒ…è¢«NATè·¯ç”±å™¨æ¥æ”¶å¹¶é‡æ–°å‘é€ç»™å†…éƒ¨ç½‘ç»œä¸­çš„ç›¸åº”ä¸»æœºï¼Œè¿™ç§æƒ…å†µå°±è¢«ç§°ä¸ºNATç¯å›ã€‚è¿™ç§è¡Œä¸ºå¯èƒ½ä¼šå½±å“ç½‘ç»œæ€§èƒ½å’Œè¡Œä¸ºï¼Œå› æ­¤éœ€è¦åœ¨NATè·¯ç”±å™¨ä¸Šè¿›è¡Œé€‚å½“çš„é…ç½®æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚
</code></pre>
<p>ä¸€æ—¦å…³é—­<code>NAT ç¯å›</code>ï¼Œæ‰€æœ‰çš„è®¿é—®åˆ° WAN çš„ IP ä¼šç›´æ¥æ‰“åˆ° op åå°ï¼Œä¸ä¼šè¢«ç«¯å£è½¬å‘ï¼Œå®¿ä¸»æœºä¸Šçš„ nginx å°†æ— æ³•ç”Ÿæ•ˆ</p>
</blockquote>
<h3 id="äº”ã€æ’ä»¶-amp-å…¶ä»–ä¸€äº›ä½¿ç”¨"><a href="#äº”ã€æ’ä»¶-amp-å…¶ä»–ä¸€äº›ä½¿ç”¨" class="headerlink" title="äº”ã€æ’ä»¶&amp;å…¶ä»–ä¸€äº›ä½¿ç”¨"></a>äº”ã€æ’ä»¶&amp;å…¶ä»–ä¸€äº›ä½¿ç”¨</h3><hr>
<h4 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h4><p><strong>1.ç®¡ç†æƒ</strong></p>
<p><code>Dropbear å®ä¾‹</code>æŒ‰éœ€ä¿®æ”¹</p>
<p><strong>2.æŒ‚è½½ç‚¹&amp;å¯åŠ¨é¡¹</strong></p>
<p>æˆ‘è¿™é‡Œéœ€è¦æŒä¹…åŒ–æŒ‚è½½ä¸€å—ç¡¬ç›˜åˆ° openwrt é‡Œé¢ï¼Œè¯•äº†ä¸‹æŒ‚è½½ç‚¹çš„æ“ä½œä¸ç”Ÿæ•ˆï¼Œæˆ‘å°±ç›´æ¥æŠŠ<code>mount /dev/sda1 /mnt/sda1</code>å†™åˆ°å¯åŠ¨é¡¹æœ€ä¸‹é¢çš„æœ¬åœ°å¯åŠ¨è„šæœ¬é‡Œé¢äº†</p>
<hr>
<h4 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h4><p><strong>1.å¾®ä¿¡æ¨é€</strong></p>
<p>å¾®ä¿¡pushplusä¸é™åˆ¶æ¡æ•°ï¼Œå¥½ç”¨ã€‚ä½†åœ¨ op çš„å®é™…æ¨é€ä¸­æ„Ÿè§‰ç”¨å¤„ä¸å¤§ï¼ŒIPV4 å’Œ IPV6 å˜åŠ¨å¯ä»¥ç”¨ DDNSè§£å†³ã€‚</p>
<p><strong>2.DDNS&#x2F;åŠ¨æ€DNS</strong></p>
<p>ä¿®æ”¹-&gt;å¯ç”¨ï¼Œç„¶åæŒ‰éœ€ä¿®æ”¹å³å¯ï¼Œæˆ‘è¿™é‡Œ IPV4 æ¥æºé€‰çš„æ˜¯<code>æ¥å£</code>-&gt;<code>pppoe-wan</code>ï¼Œ<code>æŸ¥è¯¢ä¸»æœºå</code>å’Œ<code>åŸŸå</code>éƒ½ç›´æ¥å¡«<code>xxx.xxx.xxx</code>å°±è¡Œï¼ŒæˆåŠŸé…ç½®å<code>ä¸Šæ¬¡æ›´æ–°</code> <code>ä¸‹æ¬¡æ›´æ–°</code>é‚£ä¼šå˜æˆä¸¤è¡Œæ—¶é—´ï¼Œå‡ºç°é—®é¢˜å¯ä»¥æŸ¥çœ‹æ—¥å¿—</p>
<blockquote>
<p>å¦‚æœä½ çš„åŸŸåæ˜¯<code>192.x</code>æˆ–<code>10.x</code>ç­‰ä¿ç•™åœ°å€ï¼Œå…¨å±€è®¾ç½®-&gt;<code>å…è®¸éå…¬ç½‘ IP</code><strong>ä¸€å®šè¦å‹¾é€‰ä¸Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</strong></p>
</blockquote>
<hr>
<h4 id="NAS"><a href="#NAS" class="headerlink" title="NAS"></a>NAS</h4><p><strong>1.GoWebDav</strong></p>
<p>ç®€å•ä½¿ç”¨ï¼Œç‚¹å‡»å³ç”¨ï¼Œä½†æ˜¯æœ‰ä¸ªå¼€å…³å«<code>åªè¯»æ¨¡å¼</code>ï¼Œä½†æ˜¯æˆ‘æ²¡å‘ç°åº”è¯¥æ€ä¹ˆå¾€ä¸Šä¸Šä¼ ğŸ˜­</p>
<p><strong>2.ç½‘ç»œå…±äº«</strong></p>
<p>Sambaï¼Œå¥½ç”¨ï¼Œè¸©äº†ç‚¹å°å‘ï¼Œ<strong>å¦‚æœè¦åœ¨ WAN å£åŒç½‘æ®µä¸‹ä½¿ç”¨éœ€è¦æŠŠ 445 å’Œ 139 ç«¯å£è½¬å‘åˆ°å†…éƒ¨ 192.168.100.1 çš„ 445 å’Œ 139</strong>ï¼Œ<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chentiao/p/16696051.html">æ’é”™å‚è€ƒæ•™ç¨‹</a></p>
<p>å…ˆè¿›è¡Œå‘½ä»¤è¡Œæ“ä½œï¼š</p>
<pre><code># æ›´æ–°æº
opkg update
# å®‰è£…è½¯ä»¶
opkg install shadow-common
opkg install shadow-useradd
# æ·»åŠ åå«smbkirinçš„ç”¨æˆ·
useradd smbkirin
# ä¸ºsmbkirinè®¾ç½®å¯†ç 
passwd smbkirin
# æ·»åŠ smbkirinåˆ°Sambaä¸­
smbpasswd -a smbkirin
# é‡å¯Samba
service samba restart
</code></pre>
<p>ç„¶ååœ¨ç½‘é¡µæ§åˆ¶ç•Œé¢ä¸­æ·»åŠ æ–‡ä»¶å¤¹ï¼Œåç§°éšä¾¿å–ï¼Œè·¯å¾„çœ‹ä½ å®šï¼Œç”¨æˆ·ç”¨ä¸Šé¢çš„ï¼Œæ–°æ–‡ä»¶0666ï¼ˆå¯è¯»å¯å†™ä¸å¯æ‰§è¡Œï¼‰ï¼Œç›®å½•0777</p>
<p>Windows ä¸‹è½½èµ„æºç®¡ç†å™¨è¾“å…¥<code>\\&#123;IP&#125;</code>å³å¯è®¿é—®ï¼Œå¯ä»¥æ˜ å°„åˆ°ç½‘ç»œé©±åŠ¨å™¨æ–¹ä¾¿ä½¿ç”¨</p>
<hr>
<h4 id="å…¶ä»–çš„"><a href="#å…¶ä»–çš„" class="headerlink" title="å…¶ä»–çš„"></a>å…¶ä»–çš„</h4><p><strong>1.ä½¿ç”¨IPV6</strong></p>
<blockquote>
<p>å¦‚æœä½ çš„ç½‘ç»œä¸å‘æ”¾ IPV6ï¼Œæ”¹äº†ä¹Ÿæ²¡æœ‰çš„</p>
</blockquote>
<p>åœ¨ openwrt ä¸­å®‰è£…ç»„ä»¶</p>
<pre><code>opkg update
opkg install ipv6helper
</code></pre>
<p>ä¿®æ”¹<code>vim /etc/config/network</code>è¿½åŠ å¦‚ä¸‹å†…å®¹</p>
<pre><code>config interface &#39;wan6&#39;
        option proto &#39;dhcpv6&#39;
        option ifname &#39;pppoe-wan&#39;
        option reqaddress &#39;try&#39;
        option reqprefix &#39;auto&#39;
</code></pre>
<p>è¯¦ç»†è§£é‡Š ipv6ï¼š<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/awzodmpp/">https://post.smzdm.com/p/awzodmpp/</a></p>
<blockquote>
<p>å¦‚æœè¦å®ç° ipv6 è½¬å‘åˆ° ipv4 ç«¯å£ï¼Œsocatè½¯ä»¶åŒ…èƒ½ç›´æ¥åœ¨<code>è½¯ä»¶åŒ…</code>é‡Œé¢ç‚¹ä¸€ä¸‹å®‰è£…ï¼Œ<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/559034124">socat æ•™ç¨‹</a></p>
<p>å¦‚æœè¦ç›‘å¬ 80 å’Œ 443 ç«¯å£ï¼Œå› ä¸ºè¢«<code>uhttpd</code>å ä½äº†æ‰€ä»¥éœ€è¦æ”¹ä¸€ä¸‹è®¾ç½®ï¼Œè®©<code>uhttpd</code>ä¸ç›‘å¬ IPV6 åœ°å€</p>
<pre><code># æŸ¥çœ‹uhttpç›‘å¬æƒ…å†µ
netstat -tlnp | grep uhttpd
# ä¿®æ”¹é…ç½®ï¼Œæ³¨é‡Šæ‰ipv6çš„ç›‘å¬
vi /etc/config/uhttpd
# é‡å¯uhttpd
/etc/init.d/uhttpd restart
# å†æ¬¡æŸ¥çœ‹
netstat -tlnp | grep uhttpd
</code></pre>
<p>å¦‚æœè¦åœ¨ LAN ç½‘ç»œä¸‹ä½¿ç”¨ IPV6 åŸŸåè§£æï¼Œ<code>ç½‘ç»œ</code>-&gt;<code>DHCP/DNS</code>-&gt;<code>é«˜çº§è®¾ç½®</code>-&gt;<code>ç¦æ­¢è§£æ IPV6 DNS è®°å½•</code></p>
<p>æµ‹è¯•ç«¯å£é€šæ–­<code>nmap -6 &#123;IPV6 åœ°å€&#125; -p 80,4438080,20000,30004 -Pn</code></p>
<p>clash å¼€ç€ä¼šå½±å“ ipv6 åœ°å€çš„è®¿é—®ï¼Œæ— æ•Œäº†ï¼Œåé¢å‘ç°åŸå› æ˜¯ä¼šåŸŸåä»£ç†ï¼Œå¦‚æœä½ ä¹°çš„æœºåœºçš„è¿™ä¸ªèŠ‚ç‚¹æœ‰ IPV6ï¼Œç”šè‡³å¯ä»¥ç”¨ä»£ç†è„¸ä¸Šï¼Œå³ä½¿ä½ è‡ªå·±æ²¡æœ‰ IPV6 ç½‘ç»œ</p>
<p>ä¸çŸ¥é“ä¸ºå•¥æˆ‘çš„ IPV6 é˜²ç«å¢™æ²¡ç”Ÿæ•ˆï¼Œå¯ä»¥ç›´æ¥è®¿é—®å†…ç½‘çš„è®¾å¤‡ï¼Œå‘ç° IPV4 ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œé˜²ç«å¢™æ²¡æœ‰é˜»æ–­ï¼Œæœ‰ç‚¹å¥‡æ€ªï¼Œ<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/620831429">è¿™ä¸ªæ•™ç¨‹</a>æœ‰ nmap ä½¿ç”¨æ–¹æ³•ï¼Œå“ä¸ç®¡äº†ï¼Œå¼€å°±å¼€å§</p>
</blockquote>
<p><strong>2.åŠ å…¥æ— çº¿ç½‘å¡</strong></p>
<blockquote>
<p>é¢˜å¤–è¯ä¸€å¥ï¼Œæˆ‘ä¹°çš„ N100 è‡ªå¸¦ AX101 ç½‘å¡ï¼Œæ˜¯ WiFi6 ä½†æ˜¯å¾ˆåƒåœ¾ ï¼Œæœ€é‡è¦çš„æ˜¯å®˜æ–¹æ²¡æœ‰é€‚é…é©±åŠ¨ï¼Œåœ¨ Ubuntu22.04 ç³»ç»Ÿä¸Šå¼€æœºå³å¯ä½¿ç”¨ï¼Œä½†æ˜¯å¸¦å®½ç”šè‡³è·‘ä¸æ»¡ç™¾å…†ï¼Œä¸ªäººçŒœæµ‹æ˜¯è¯†åˆ«æˆäº†å…¶ä»–ç½‘å¡èƒ½ç”¨ä½†æ˜¯è°ƒåº¦ä¸å¥½ï¼Œè·‘ä¸æ»¡åƒå…†ä¹Ÿèƒ½ç†è§£ï¼Œä½†æ˜¯è·‘ä¸æ»¡ç™¾å…†å°±æœ‰ç‚¹ç¦»è°±äº†ã€‚</p>
<p>æœ€åä»å®¤å‹çš„æ³¡æ°´æœºä¸Šå–äº†ä¸ª MT7921ï¼Œæ— çº¿å‘å°„å¸¦å®½å®æµ‹åˆšå¥½ 100Mï¼Œèƒ½ç”¨è¿˜è¡Œ</p>
</blockquote>
<p>æœ‰å°è¯•ä½¿ç”¨ macvlan ç­‰æ“ä½œæŒ‚è¿› openwrtï¼Œä¸è¿‡æƒ³äº†æƒ³å¥½åƒç”¨å¤„ä¸å¤§ï¼Œæœ€ç»ˆçš„æ–¹æ³•æ˜¯ç›´æ¥å¼€ä¸€ä¸ªçƒ­ç‚¹ï¼ŒæŠŠ<code>192.168.100.100</code>è·å¾—çš„ç½‘ç»œå…±äº«å‡ºå»</p>
<pre><code># ä½¿ç”¨nmcliå¯ç”¨WiFi
sudo nmcli device wifi hotspot ifname &#123;ç½‘å¡åç§°ï¼Œå¦‚wlp1s0&#125; con-name &#123;åœ¨nmä¸­çš„åå­—&#125; ssid &#123;WiFiåå­—&#125; password &#123;å¯†ç &#125;
# å¦‚ä¸‹
# sudo nmcli device wifi hotspot ifname wlp1s0 con-name nmcli-wifi ssid n100-wifi password 123456789
</code></pre>
<blockquote>
<p>ä¹Ÿæ˜¯é‡å¯ä¼šå¤±æ•ˆï¼Œæ‰€ä»¥åŠ å…¥ä¹‹å‰å†™çš„å¼€æœºè„šæœ¬é‡Œ</p>
</blockquote>
<p><strong>æœ€ç»ˆçš„è„šæœ¬å†…å®¹</strong>ï¼Œä¸ºäº†ä»¥é˜²ä¸‡ä¸€åˆåŠ å…¥äº†ä¸¤å¥åˆ é™¤æŒ‡ä»¤<code>sudo ip link del me_to_op</code>  å’Œ <code>nmcli connection delete nmcli-wifi</code></p>
<pre><code>sudo ip link set enp4s0 promisc on
sudo ip link set enp2s0 promisc on

sudo ip link del me_to_op
sudo ip link add me_to_op link enp2s0 type macvlan mode bridge
sudo ip addr add 192.168.100.100 dev me_to_op
sudo ip link set me_to_op up
sudo ip route add 192.168.100.1 dev me_to_op
sudo route add default gw 192.168.100.1 me_to_op

sudo sh -c &#39;echo &quot;nameserver 192.168.100.1&quot; &gt; /etc/resolv.conf&#39;

sudo nmcli connection delete nmcli-wifi
sudo nmcli device wifi hotspot ifname wlp1s0 con-name nmcli-wifi ssid n100-wifi password 123456789
</code></pre>
<p>å› ä¸ºä½¿ç”¨çš„æ˜¯çƒ­ç‚¹ï¼Œæ‰€ä»¥<code>ifconfig</code>ä¸­æ— çº¿ä¼šå˜æˆä¸€ä¸ª<code>10.x</code>çš„ç½‘æ®µï¼Œé“¾æ¥ä¸ŠWiFiçš„è®¾å¤‡ä¹Ÿä¼šè·å¾—<code>10.x</code>çš„ç½‘æ®µï¼Œä¸è¿‡è·Ÿæˆ‘çš„ WAN å£åœ°å€ä¸å†²çªï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå°±ä¸ç®¡äº†ï¼Œåº”ä¹Ÿè¯¥å¯ä»¥æ”¹ç½‘æ®µçš„ã€‚<strong>ï¼ˆåè®°ï¼šè¿™æ ·ä¼¼ä¹èƒ½è¿ä¸Šä½†ä¸èƒ½ä¸Šç½‘ï¼Œæˆ‘å·²ç»æ¢æˆä¸‹é¢çš„æ–¹å¼äº†ï¼‰</strong></p>
<blockquote>
<p><strong>å¦‚æœè¦æŠŠ WiFi æŒ‚è¿› openwrt è€Œéä¸Šé¢é‚£æ ·ï¼Œåˆ™éœ€æ“ä½œå¦‚ä¸‹</strong></p>
<p><strong>å…ˆæŒ‰ä¸Šé¢çš„æ–¹æ³•æŠŠ WiFi æ‰“å¼€åå†ä½¿ç”¨ä¸‹é¢çš„æ“ä½œ</strong></p>
<pre><code>docker network create -d macvlan --subnet=192.168.200.0/24 --gateway=192.168.200.1 -o parent=wlp1s0 op_wifi
docker network connect op_wifi openwrt
</code></pre>
<p>ä¿®æ”¹<code>/etc/config/network</code></p>
<pre><code>config interface &#39;lanwifi&#39;
     option type &#39;bridge&#39;
     option ifname &#39;eth2&#39;
     option proto &#39;static&#39;
     option netmask &#39;255.255.255.0&#39;
     option ip6assign &#39;60&#39;
     option ipaddr &#39;192.168.200.1&#39;
</code></pre>
<p>åŒæ ·è®¾ç½®é˜²ç«å¢™åˆ° LAN</p>
<p>ä¼¼ä¹è¿™æ ·åšé“¾æ¥ä¸Š WIFI çš„è®¾å¤‡å…ˆä¼šå¾—åˆ°<code>10.x</code>çš„ IPï¼Œç„¶åå˜æˆä¸€ä¸ª<code>192.168.200.x</code>çš„ IPï¼Œæˆ‘æ„Ÿè§‰åº”è¯¥æ‰¾ä¸€æ‰¾ WiFi çƒ­ç‚¹èƒ½å‘é€ä½†æ˜¯ä¸åˆ†é… IP çš„æ–¹æ¡ˆï¼Œç„¶åç›´æ¥è®© op æ¥å‘ IPï¼Œè·Ÿ LAN å°±ä¸€æ ·çš„äº†ï¼Œè€Œä¸”è¿™æ ·å°±ä¸ä¼šåƒ LAN ä¸€æ ·è¿˜çš„æ’ä¸ªä¸œè¥¿æ‰èƒ½å·¥ä½œã€‚æˆ–è®¸è¿˜å¯ä»¥è€ƒè™‘ä¸€ä¸‹éƒ½åˆ†è¿› 100 ç½‘æ®µé‡Œé¢ï¼Œä¸¤ä¸ª DHCP æœåŠ¡å™¨å„å‘å„çš„ï¼Œæˆ–è®¸ä¹Ÿä¸ä¼šå†²çªï¼Ÿ</p>
</blockquote>
<h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>ä»è´­å…¥åˆ°ä»Šå¤©åˆšå¥½åå¤©ï¼Œç»ˆäºæ¯é¥¬çš„å·®ä¸å¤šäº†ï¼Œçˆ½ï¼ä»æ˜¨å¤©å¼€å§‹ç‹‚å†™ 4K å­—çš„æ•™ç¨‹ï¼Œå¿…é¡»ç‹ ç‹ åœ°è®°å½•ï¼æˆ‘ç»ˆå°†æˆä¸º op é«˜æ‰‹ï¼</p>
<p>ä»¥åŠæ„Ÿè°¢ <a target="_blank" rel="noopener" href="https://blog.zzsqwq.cn/">zzsqwq</a> çš„åˆ†ææ’é”™ï¼Œç¥ï¼è¿˜æœ‰ KirCute çš„ä¸€é—®ï¼šâ€œè¿™ç¯æ€ä¹ˆæ²¡äº®â€ï¼Œä»è€Œæƒ³åˆ° LAN å£ä¸æ’ä¸œè¥¿å°±ä¸å·¥ä½œï¼Œæ— æ•Œï¼</p>

        </article>
        
        <section class="post-near">
            <ul>
                
                    <li>ä¸Šä¸€ç¯‡: <a href="/7777/07/07/diary/">ç¨€ç–å¹³å¸¸çš„ç”Ÿæ´»</a></li>
                
                
                    <li>ä¸‹ä¸€ç¯‡: <a href="/2024/03/22/24.gitea+DroneCI/">gitea+Drone CIå®ç°hexoåšå®¢è‡ªåŠ¨éƒ¨ç½²</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/openwrt/" rel="tag">openwrt</a>
            </section>
        
        <script src="https://giscus.app/client.js"
        data-repo="qllokirin/hexo_blog_comments"
        data-repo-id="R_kgDOI8fvWA"
        data-category="Announcements"
        data-category-id="DIC_kwDOI8fvWM4CUIlh"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
        </script>
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="https://s2.loli.net/2022/09/27/6rzl4WOitu8pUqg.jpg" alt="qllokirin" />
            </figure>
        
            <div class="author-info">
                <h4>qllokirin</h4>
                <p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç¥ˆè±ä¸æ˜¯éº’éºŸ(qllokirin)ï¼Œå¾ˆé«˜å…´ä¸ä½ ç›¸é‡</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <a class="to-top" href="#"></a>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">æœ€æ–°æ–‡ç« ï¼š</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/7777/07/07/diary/">ç¨€ç–å¹³å¸¸çš„ç”Ÿæ´»</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/04/11/25.N100_op/">N100åŒç½‘å£å°ä¸»æœºä½¿ç”¨dockerç‰ˆopenwrtåšä¸»è·¯ç”±ï¼ˆPPPoEæ‹¨å·ï¼‰è¶…è¯¦ç»†ï¼ï¼ï¼ï¼</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/03/22/24.gitea+DroneCI/">gitea+Drone CIå®ç°hexoåšå®¢è‡ªåŠ¨éƒ¨ç½²</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/02/19/23.remote_control_switch/">å®¿èˆé¥æ§å¼€å…³æ•´æ”¹è®¡åˆ’</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/02/14/22.home_network_upgrade/">å®¶åº­ç½‘ç»œæ‹“æ‰‘æ•´æ”¹æ—¥è®°</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/08/18/21.computer_optimize/">åç¡•å¤©é€‰2ç¬”è®°æœ¬ä¼˜åŒ–</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">æ—¶å…‰æœºï¼š</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/7777/07/">July 7777</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">æ ‡ç­¾äº‘ï¼š</h3>
                    <a href="/tags/Drone-CI/" style="font-size: 10px;">Drone CI</a> <a href="/tags/EasyConnect/" style="font-size: 10px;">EasyConnect</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/clash/" style="font-size: 10px;">clash</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/hexo/" style="font-size: 20px;">hexo</a> <a href="/tags/livehouse/" style="font-size: 10px;">livehouse</a> <a href="/tags/openwrt/" style="font-size: 20px;">openwrt</a> <a href="/tags/px4/" style="font-size: 10px;">px4</a> <a href="/tags/ros/" style="font-size: 20px;">ros</a> <a href="/tags/tmux/" style="font-size: 10px;">tmux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/vocaloid/" style="font-size: 10px;">vocaloid</a> <a href="/tags/%E4%BA%91%E5%B4%BD/" style="font-size: 10px;">äº‘å´½</a> <a href="/tags/%E5%8F%8C%E7%AC%99/" style="font-size: 10px;">åŒç¬™</a> <a href="/tags/%E5%AE%B6%E5%BA%AD%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">å®¶åº­ç½‘ç»œ</a> <a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 10px;">æ—…æ¸¸</a> <a href="/tags/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BB%84%E8%A3%85/" style="font-size: 10px;">æ— äººæœºç»„è£…</a> <a href="/tags/%E6%97%A5%E8%AE%B0/" style="font-size: 10px;">æ—¥è®°</a> <a href="/tags/%E6%AD%8C/" style="font-size: 10px;">æ­Œ</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">æ¯”èµ›</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">æµ‹è¯•</a> <a href="/tags/%E7%95%AA/" style="font-size: 10px;">ç•ª</a> <a href="/tags/%E7%AC%94%E8%AE%B0%E6%9C%AC%E4%BC%98%E5%8C%96/" style="font-size: 10px;">ç¬”è®°æœ¬ä¼˜åŒ–</a> <a href="/tags/%E8%A3%85%E6%9C%BA/" style="font-size: 10px;">è£…æœº</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">è®°å½•</a> <a href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/" style="font-size: 10px;">è·¯ç”±å™¨</a> <a href="/tags/%E9%81%A5%E6%8E%A7%E5%BC%80%E5%85%B3/" style="font-size: 10px;">é¥æ§å¼€å…³</a> <a href="/tags/%E9%87%8D%E8%A3%85/" style="font-size: 10px;">é‡è£…</a> <a href="/tags/%E9%AD%94%E6%B3%95/" style="font-size: 10px;">é­”æ³•</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>Â© 2024 <a href="/">qllokirin</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":false,"night":false});</script>

  </body>
</html>
