
  <!DOCTYPE html>
  <html lang="zh-CN"  >
  <head>
  <meta charset="utf-8">
  

  

  

  
  <script>window.icon_font = '4552607_tq6stt6tcg';window.clipboard_tips = {"success":"复制成功～(∠・ω< )⌒☆","fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","copyright":{"enable":false,"count":50,"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！"}};</script>
  
  
  <title>
    ros入门 |
    
    qllokirin
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  
    <meta name="description" content="最近看到学弟学妹在学ros，回想我当时学ros的痛苦时光，想着能不能写一个教程">
<meta property="og:type" content="article">
<meta property="og:title" content="ros入门">
<meta property="og:url" content="http://example.com/2022/10/17/06.ros/index.html">
<meta property="og:site_name" content="qllokirin">
<meta property="og:description" content="最近看到学弟学妹在学ros，回想我当时学ros的痛苦时光，想着能不能写一个教程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/ros_1.png">
<meta property="og:image" content="http://example.com/images/ros_2.png">
<meta property="og:image" content="http://example.com/images/ros_3.png">
<meta property="og:image" content="http://example.com/images/ros_4.png">
<meta property="article:published_time" content="2022-10-17T04:10:42.000Z">
<meta property="article:modified_time" content="2023-01-28T04:09:46.000Z">
<meta property="article:author" content="qllokirin">
<meta property="article:tag" content="ros">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/ros_1.png">
  
  
    <link rel="alternate" href="/atom.xml" title="qllokirin" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  
  
  
    
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"></script>

  
  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.0.1/dist/aos.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
          <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="#66ccff" />
          <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
         M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="#66ccff" />
        </svg>
      </div>
      <div class="loading-word">天依再吃俩包子(๑＞⌔＜๑)8</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/">首页</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/archives">归档</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/about">关于</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/friend">友链</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅" target="_blank"></a>
    
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="搜索"></a>
    
  </nav>
</div>
<header id="header">
  
    
      <img fetchpriority="high" src="/images/luo.png" alt="ros入门">
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">ros入门</h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content">
          
          <section id="main"><article id="post-06.ros" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <a href="/2022/10/17/06.ros/" class="article-date-link" data-aos="zoom-in">
    <time datetime="2022-10-17T04:10:42.000Z" itemprop="datePublished">2022-10-17</time>
    <time style="display: none;" id="post-update-time">2023-01-28</time>
  </a>
</div>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%99%E7%A8%8B/" data-aos="zoom-in">教程</a>
  </div>


    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>最近看到学弟学妹在学ros，回想我当时学ros的痛苦时光，想着能不能写一个教程</p>
<span id="more"></span>

<blockquote>
<p>在写了在写了</p>
</blockquote>
<p>这里官方教程：<a target="_blank" rel="noopener" href="http://wiki.ros.org/cn/ROS/Tutorials">http://wiki.ros.org/cn/ROS/Tutorials</a></p>
<p>我刚学的时候竟然没有搜到这个教程，枯了，说的还是很细致的，主要是很全<del>不过感觉略显枯燥（?）</del></p>
<blockquote>
<p>初入Linux也可以先学习一下Linux基本操作：<a target="_blank" rel="noopener" href="https://mapleroid.github.io/unix_tutorial/index.html">https://mapleroid.github.io/unix_tutorial/index.html</a></p>
</blockquote>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFros">什么是ros</a></li>
<li><a href="#%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1">在命令行中进行话题通信</a></li>
<li><a href="#%E7%94%A8c++%E5%AE%9E%E7%8E%B0%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1">用c++实现话题通信</a></li>
</ul>
<h1 id="什么是ros"><a href="#什么是ros" class="headerlink" title="什么是ros"></a>什么是ros</h1><p>全称是Robot Operating System，中文为<strong>机器人操作系统</strong></p>
<p>我认为最主要的是理解<strong>话题（topic）</strong>这个概念，由此又一个概念叫<strong>节点</strong></p>
<p>一个<strong>话题</strong>可以被订阅，也可以往里发布内容，做这些事的叫<strong>节点</strong>，这也是我们所说的<strong>订阅者</strong>和<strong>发布者</strong></p>
<p><strong>就像这里有一个正方形的门，它就是一个话题，一边有一人P在往里输入正方形的物体，它就是发布者，也是一个节点，另一边有一人S在收这个正方形的物体，他就是订阅者，也是一个节点。这个正方形就是某种指定的数据类型</strong></p>
<p>下面是一些有关话题的<strong>命令行指令</strong>，或许你现在还不太清楚，但不要紧</p>
<p>话题名形如<code>/cmd_vel</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前的所有话题</span><br><span class="line">rostopic list</span><br><span class="line"># 查看某个话题的订阅者、发布者、发布内容的数据类型</span><br><span class="line">rostopic info 话题名</span><br><span class="line"># 查看该话题发布的具体内容</span><br><span class="line"># -n 可以指定发布次数</span><br><span class="line">rostopic echo 话题名</span><br><span class="line"># 查看一个话题的发布频率</span><br><span class="line">rostopic hz 话题名</span><br><span class="line"># 查看某个数据类型的具体内容</span><br><span class="line">rosmsg show 数据类型名称</span><br><span class="line"># 向某个话题里发布内容 可以使用tab自动补全</span><br><span class="line"># -n 可以指定发布次数 -r 可以指定发布频率</span><br><span class="line">rostopic pub 话题名 数据类型 数据内容</span><br><span class="line"># 可以把某个话题保存到.bag文件</span><br><span class="line">rosbag record 话题名</span><br><span class="line"># 可以把.bag文件保存的内容发布出去</span><br><span class="line"># -s 可以指定开始秒数 -r 可以指定发布速度</span><br><span class="line">rosbag play .bag文件</span><br><span class="line">#动态调参</span><br><span class="line">rosrun rqt_reconfigure rqt_reconfigure</span><br><span class="line">#图形化发布服务</span><br><span class="line">rosrun rqt_service_caller rqt_service_caller</span><br><span class="line">#图形化查看话题</span><br><span class="line">rosrun rqt_topic rqt_topic</span><br></pre></td></tr></table></figure>

<h1 id="在命令行中进行话题通信"><a href="#在命令行中进行话题通信" class="headerlink" title="在命令行中进行话题通信"></a>在命令行中进行话题通信</h1><blockquote>
<p>还没有安装ros？跟着官网一步一步做就好了</p>
<p>ubuntu20.04-&gt;<a target="_blank" rel="noopener" href="http://wiki.ros.org/cn/noetic/Installation/Ubuntu">官网安装教程</a></p>
</blockquote>
<p>先使用小乌龟（经典）操作一下吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 打开一个终端（ctrl+alt+T）输入 回车</span><br><span class="line">roscore</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 再打开一个终端输入 回车 就可以看到小乌龟啦</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br></pre></td></tr></table></figure>

<p>再打开一个终端备用，现在的情况大概如下图</p>
<p><img src="/images/ros_1.png" alt="ros_1"></p>
<p>接下来我们先熟悉一下一些基本<strong>命令行指令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前的所有话题</span><br><span class="line">rostopic list</span><br></pre></td></tr></table></figure>

<blockquote>
<p>$ <strong>rostopic list</strong><br>&#x2F;rosout<br>&#x2F;rosout_agg<br>&#x2F;turtle1&#x2F;cmd_vel<br>&#x2F;turtle1&#x2F;color_sensor<br>&#x2F;turtle1&#x2F;pose</p>
</blockquote>
<p>这里有五个话题在发布（或者订阅）着某种数据类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 我们先来查看一下/turtle1/pose的情况</span><br><span class="line">rostopic info /turtle1/pose</span><br></pre></td></tr></table></figure>

<blockquote>
<p>$ rostopic info &#x2F;turtle1&#x2F;pose</p>
<p>Type: turtlesim&#x2F;Pose</p>
<p>Publishers: </p>
<p>* &#x2F;turtlesim (<a target="_blank" rel="noopener" href="http://magic:36353/">http://magic:36353/</a>)</p>
<p>Subscribers: None</p>
</blockquote>
<p>这里的意思是<code>/turtle1/pose</code>这个话题在被<code>/turtlesim</code>节点发布（Publisher）没有被人订阅，内容物是一个叫<code>turtlesim/Pose</code>的数据类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看这个数据类型的具体内容物</span><br><span class="line">rosmsg show turtlesim/Pose</span><br></pre></td></tr></table></figure>

<p>可以看到有五个float类型的变量，他们的含义和就是变量名的英文啦，例如xy是小乌龟的坐标，theta是角度</p>
<p>那数据内容到底是什么呢，用下面指令可以查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看话题具体内容物</span><br><span class="line">rostopic echo /turtle1/pose</span><br></pre></td></tr></table></figure>

<p>可以看到数据一直在刷新，这样我们就在命令行实现了话题的订阅（Subscriber）</p>
<blockquote>
<p> 按下<code>Ctrl+c</code>可以终止这个程序</p>
</blockquote>
<p>让我们回到话题列表，你会发现有一个<code>/turtle1/cmd_vel</code>的话题，他就是控制小乌龟<strong>移动</strong>的话题，仿照上面的<code>rostopic info</code>操作，可以发现<code>/turtlesim</code>节点一直在订阅（Subscriber），而没有人发布（Publisher），那我们来发布就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 不建议直接复制 自己打一点然后使用&lt;tab&gt;按键自动补全就好</span><br><span class="line">rostopic pub /turtle1/cmd_vel geometry_msgs/Twist &quot;linear:</span><br><span class="line">  x: 1.0</span><br><span class="line">  y: 0.0</span><br><span class="line">  z: 0.0</span><br><span class="line">angular:</span><br><span class="line">  x: 0.0</span><br><span class="line">  y: 0.0</span><br><span class="line">  z: 0.0&quot; </span><br></pre></td></tr></table></figure>

<p>设置线速度是1.0，发现小乌龟往前走了一点距离，如果想控制小乌龟一直移动，可以用-r 参数指定频率</p>
<p>（即1s内发送消息的次数）然后设置一下角速度，就可以走圆了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 可以一直走一个圆</span><br><span class="line">rostopic pub -r 10 /turtle1/cmd_vel geometry_msgs/Twist &quot;linear:</span><br><span class="line">  x: 1.0 </span><br><span class="line">  y: 0.0</span><br><span class="line">  z: 0.0</span><br><span class="line">angular:</span><br><span class="line">  x: 0.0</span><br><span class="line">  y: 0.0</span><br><span class="line">  z: 1.0&quot;</span><br></pre></td></tr></table></figure>

<p>现在应大致如下图</p>
<p><img src="/images/ros_2.png" alt="ros_1"></p>
<p>现在你应该明白了，我们可以通过<strong>话题通信</strong>的方式订阅（Subscriber）到小乌龟的位置信息<code>/turtle1/pose</code>、向速度话题<code>/turtle1/cmd_vel</code>里发布（Publisher）速度控制小乌龟移动</p>
<p>接下来我将以<strong>c++<strong>为例演示如何在</strong>代码</strong>中实现这部分操作</p>
<ul>
<li>下面是几个可能用到工具</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 图形化查看节点和话题 圆圈住的是节点名，曲线上的是话题名</span><br><span class="line">rosrun rqt_graph rqt_graph</span><br><span class="line"># 图形化查看某个话题里面的数据</span><br><span class="line">rosrun rqt_plot rqt_plot</span><br><span class="line"># 如果一个话题里是画面，可以用这个查看</span><br><span class="line">rosrun rqt_image rqt_image</span><br></pre></td></tr></table></figure>

<h1 id="用c-实现话题通信"><a href="#用c-实现话题通信" class="headerlink" title="用c++实现话题通信"></a>用c++实现话题通信</h1><h2 id="1、准备工作"><a href="#1、准备工作" class="headerlink" title="1、准备工作"></a>1、准备工作</h2><ul>
<li><p>1.创建工作空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 新建文件夹catkin_ws/src 这样的话工作空间就叫catkin_ws</span><br><span class="line">mkdir -p ~/catkin_ws/src</span><br><span class="line"># 进入catkin_ws/src文件夹</span><br><span class="line">cd ~/catkin_ws/src</span><br><span class="line"># 初始化工作空间 会在当前目录生成一个CmakeLists.txt文件</span><br><span class="line">catkin_init_workspace</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.编译工作空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 编译时要进入工作空间根目录</span><br><span class="line">cd ~/catkin_ws/</span><br><span class="line"># 编译 每次有新功能包或者修改代码之后都要编译</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.设置环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 这样是让当前终端生效</span><br><span class="line">source ~/catkin_ws/devel/setup.bash</span><br></pre></td></tr></table></figure>

<p>如果不想每次打开一个新终端都source一下的话，在用户根目录下找到<code>.bashrc</code>文件，把<code>source ~/catkin_ws/devel/setup.bash</code>写入到最后一行然后保存</p>
<blockquote>
<p>以<code>.</code>开头的文件是默认隐藏的，按下<code>ctrl+h</code>可以显示隐藏的文件</p>
</blockquote>
</li>
<li><p>4.创建功能包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 进入指定位置</span><br><span class="line">cd ~/catkin_ws/src</span><br><span class="line"># 创建功能包 这句指令应该在src目录下运行</span><br><span class="line">catkin_create_pkg control_tortoise roscpp rospy std_msgs geometry_msgs turtlesim</span><br></pre></td></tr></table></figure>

<p><code>control_tortoise</code>是功能包的名字，后面都是一些依赖</p>
</li>
</ul>
<p>当前<strong>文件夹结构</strong>应该如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">catkin_ws --- 工作空间名字，其他名字也是可以的</span><br><span class="line"></span><br><span class="line">    |--- build:编译空间，catkin_make时候会生成</span><br><span class="line"></span><br><span class="line">    |--- devel:开发空间，catkin_make时候会生成</span><br><span class="line"></span><br><span class="line">    |--- src: 源码</span><br><span class="line"></span><br><span class="line">        |-- package1：功能包1(ROS基本单元)，只能由字母、数字与下划线组成</span><br><span class="line"></span><br><span class="line">            |-- CMakeLists.txt 配置编译规则 需要进行一定的修改</span><br><span class="line"></span><br><span class="line">            |-- package.xml 包信息</span><br><span class="line"></span><br><span class="line">            |-- scripts 存储python文件</span><br><span class="line"></span><br><span class="line">            |-- src 存储C++源文件</span><br><span class="line"></span><br><span class="line">            |-- include 头文件</span><br><span class="line"></span><br><span class="line">            |-- launch 可一次性运行多个节点 </span><br><span class="line"></span><br><span class="line">        |-- package2：功能包2</span><br><span class="line"></span><br><span class="line">        |-- package3：功能包3</span><br><span class="line"></span><br><span class="line">        |-- CMakeLists.txt: 编译的基本配置 初始化工作空间时生成</span><br></pre></td></tr></table></figure>

<h2 id="2、源码书写"><a href="#2、源码书写" class="headerlink" title="2、源码书写"></a>2、源码书写</h2><p>如上文件结构所示，cpp文件放在src中，先生成一个main.cpp（运行<code>touch main.cpp</code>即可生成）</p>
<p>建议自己打一打喔~ 最好能理解</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ros语法基本头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="comment">//小乌龟速度的数据类型是geometry_msgs::Twist所以引入以下头文件（geometry_msgs在cmake中find_package里已经填写过了</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="comment">//小乌龟位置的数据类型是turtlesim::Pose所以引入以下头文件（turtlesim在cmake中find_package里已经填写过了</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;turtlesim/Pose.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//申明全局变量速度和位置 和int a之类的其实差不多</span></span><br><span class="line">geometry_msgs::Twist vel;</span><br><span class="line"></span><br><span class="line">turtlesim::Pose pose;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里是回调函数callback 每次运行ros::spinOnce()就会调用回调函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pose_update_cb</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//回调函数读出小乌龟位置信息然后存入pose变量中</span></span><br><span class="line">	pose = (*msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//主程序</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//初始化ROS,它允许ROS通过命令行进行名称重映射</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;control_tortoise&quot;</span>);</span><br><span class="line">	<span class="comment">//为这个进程的节点创建一个句柄</span></span><br><span class="line">	ros::NodeHandle n;</span><br><span class="line">	<span class="comment">//创建一个订阅者，名叫pose_sub，因为是订阅者所以是subscribe，数据类型是turtlesim::Pose</span></span><br><span class="line">	<span class="comment">//括号里面第一个参数是话题名，第二个是队列长度，不明白的话就用1，第三个是回调函数，会读取队列里面的数据</span></span><br><span class="line">	ros::Subscriber pose_sub = n.<span class="built_in">subscribe</span>&lt;turtlesim::Pose&gt;(<span class="string">&quot;/turtle1/pose&quot;</span>, <span class="number">1</span>, pose_update_cb);</span><br><span class="line">	<span class="comment">//创建一个发布者，名叫vel_pub，因为是发布者所以是advertise，数据类型是geometry_msgs::Twist</span></span><br><span class="line">	<span class="comment">//括号里面第一个参数是话题名，第二个是队列长度，不明白的话就用1，因为是发布者所以没有回调函数</span></span><br><span class="line">	ros::Publisher vel_pub = n.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="comment">//指定循环频率是10，r为变量名</span></span><br><span class="line">	<span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//进入循环 当我们按下ctrl+c终止程序时循环结束</span></span><br><span class="line">	<span class="keyword">while</span> (ros::<span class="built_in">ok</span>()) &#123;</span><br><span class="line">		<span class="comment">//打印pose的信息</span></span><br><span class="line">		<span class="built_in">ROS_INFO</span>(<span class="string">&quot;pose : (%.2lf , %.2lf)&quot;</span>, pose.x, pose.y);</span><br><span class="line">		<span class="comment">//设定速度</span></span><br><span class="line">		vel.linear.x = <span class="number">1.0</span>;</span><br><span class="line">		vel.angular.z = <span class="number">1.0</span>;</span><br><span class="line">		<span class="comment">//发布速度</span></span><br><span class="line">		vel_pub.<span class="built_in">publish</span>(vel);</span><br><span class="line">		<span class="comment">//调用回调函数</span></span><br><span class="line">		ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">		<span class="comment">//睡一下 以达到我们设定的频率</span></span><br><span class="line">		r.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、编译工作空间"><a href="#3、编译工作空间" class="headerlink" title="3、编译工作空间"></a>3、编译工作空间</h2><ul>
<li>编译之前首先要去<strong>功能包</strong>下的CMakeLists.txt修改一些东西</li>
</ul>
<p><img src="/images/ros_3.png" alt="ros_3"></p>
<p>看到138行152、153、153 （或许在这几行附近）把注释去掉</p>
<p>改为如下样子</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 括号里第一个参数是节点的名字</span></span><br><span class="line"><span class="comment"># 第二个参数是cpp文件的路径，从功能包根目录开始 可以写多个cpp</span></span><br><span class="line"><span class="keyword">add_executable</span>(control_tortoise_node src/main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此处节点名保持和上述一直</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(control_tortoise_node</span><br><span class="line">   <span class="variable">$&#123;catkin_LIBRARIES&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>编译</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 编译时要进入工作空间根目录</span><br><span class="line">cd ~/catkin_ws</span><br><span class="line"># 编译</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure>

<blockquote>
<p>没有红色报错的话就算是成功啦</p>
</blockquote>
<h2 id="4、运行"><a href="#4、运行" class="headerlink" title="4、运行"></a>4、运行</h2><p>还是和之前一样把小乌龟启动起来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 终端1</span><br><span class="line">roscore</span><br><span class="line"># 终端2</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br></pre></td></tr></table></figure>

<p>现在已经准备就绪，接下来的就是把我们的程序运行起来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># rosrun命令可以启动某个节点 第一个参数书是功能包的名字 第二个参数是节点名字</span><br><span class="line"># 功能包的名字是在我们生成功能包时命名的 节点的名字则是在cmakelist中填写的 还记得吗</span><br><span class="line">rosrun control_tortoise control_tortoise_node</span><br></pre></td></tr></table></figure>

<p>如果不出意外的小乌龟就可以正常转圈，控制台输出位置信息了</p>
<p>还可以使用<code>rosrun rqt_plot rqt_plot</code>图形化查看数据内容</p>
<p><img src="/images/ros_4.png" alt="ros_4"></p>
<p>现在的你是否可以自己订阅一个话题或者往一个话题里面发布消息呢</p>
<h2 id="5、launch文件"><a href="#5、launch文件" class="headerlink" title="5、launch文件"></a>5、launch文件</h2><p>有些时候使用的是roslaunch而并非rosrun，roslaunch的好处在于可以一次性<strong>开很多个节点</strong></p>
<p>在功能包下新建launch文件，并生成一个<code>control_tortoise.launch</code></p>
<p>填入如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;control_tortoise&quot;</span> <span class="attr">type</span>=<span class="string">&quot;control_tortoise_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;control_tortoise_name&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>pkg代表功能包的名字   type是节点名   name可以随意取名   <code>output=&quot;screen&quot;</code>意味着结果会输出在控制台</p>
<p>这时候可以输入<code>roslaunch control_tortoise control_tortoise.launch</code>来代替<code>rosrun control_tortoise control_tortoise_node</code></p>
<blockquote>
<p>此外，当使用launch文件时，可以进行配置文件的读入、话题的重映射、命名空间的书写等等操作</p>
<p>下面是一个launch实例，<strong>没有实际意义</strong>，只是向你表述launch的各种使用方法，比如arg、remap、node、include、rosparam、group等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;map_frame&quot;</span> <span class="attr">default</span>=<span class="string">&quot;map&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/odom&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/base_link&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find mavros)/launch/px4.launch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;fcu_url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/dev/ttyUSB0:57600&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;camera&quot;</span> <span class="attr">type</span>=<span class="string">&quot;transform_cam_to_10hz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;transform_cam_to_10hz&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">type</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;rviz&quot;</span> <span class="attr">args</span>=<span class="string">&quot;-d $(find uav_robotcup)/rviz/local.rviz&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">type</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find uav_robotcup)/params/settings.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">ns</span>=<span class="string">&quot;door&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">type</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">name</span>=<span class="string">&quot;move_base&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">clear_params</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;controller_frequency&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10.0&quot;</span>/&gt;</span> </span><br><span class="line">    		<span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find nav_2d_door)/params/costmap_common_params.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;global_costmap&quot;</span>/&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/laser/scan&quot;</span> <span class="attr">to</span>=<span class="string">&quot;$(arg laser_topic)&quot;</span>/&gt;</span></span><br><span class="line">   		<span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;tf_world_to_map_broadcaster&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">args</span>=<span class="string">&quot;0 0 0 0 0 0 world map 100&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="tf坐标转换"><a href="#tf坐标转换" class="headerlink" title="tf坐标转换"></a>tf坐标转换</h1><blockquote>
<p>建议先行阅读<a target="_blank" rel="noopener" href="http://wiki.ros.org/tf">ros wiki的tf教程</a>以及<a target="_blank" rel="noopener" href="http://wiki.ros.org/tf/Tutorials/Introduction%20to%20tf">发布坐标转换</a> 下文主要向你表述在px4+gazebo11仿真情况下如何连接飞机的坐标系</p>
<p>其他动态tf连接同理，如果你没有安装px4，不需要跟着教程一步一步实现，看明白即可</p>
</blockquote>
<p>飞机的定位信息在<code>mavros/local_position/pose</code>中发布，包含坐标xyz以及四元数xyzw</p>
<p>使用<code>rosrun rqt_tf_tree rqt_tf_tree</code>中查看tf树可以看到一个游离的map和base_link，我们的目标就是<strong>把这两个坐标系正确的连接起来</strong></p>
<p>示例代码如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tf/transform_broadcaster.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/PoseStamped.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> geometry_msgs::PoseStamped&amp; msg)</span></span>&#123;</span><br><span class="line">    # 申明一个静态的广播用来转发</span><br><span class="line">	<span class="type">static</span> tf::TransformBroadcaster br;</span><br><span class="line">    # 这个变量是用来表示两个坐标系的变换关系</span><br><span class="line">	tf::Transform transform;</span><br><span class="line">    # 先设置xyz坐标的关系</span><br><span class="line">	transform.<span class="built_in">setOrigin</span>(tf::<span class="built_in">Vector3</span>(msg.pose.position.x, msg.pose.position.y, msg.pose.position.z));</span><br><span class="line">    # 申明一个tf的四元数</span><br><span class="line">	tf::Quaternion q;</span><br><span class="line">    # 从msg类型的四元数转换到tf的四元数（tf::中还有其他方法可以使用）</span><br><span class="line">	tf::<span class="built_in">quaternionMsgToTF</span>(msg.pose.orientation,q);</span><br><span class="line">    # 如果是用欧拉角则使用下面的这个函数</span><br><span class="line">	<span class="comment">//q.setRPY(0, 0, msg-&gt;theta);</span></span><br><span class="line">    # 设定四元数</span><br><span class="line">	transform.<span class="built_in">setRotation</span>(q);</span><br><span class="line">    # 发布坐标转换，前者是父坐标系，后者是子坐标系</span><br><span class="line">	br.<span class="built_in">sendTransform</span>(tf::<span class="built_in">StampedTransform</span>(transform, ros::Time::<span class="built_in">now</span>(), <span class="string">&quot;map&quot;</span>, <span class="string">&quot;base_link&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span>&#123;</span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;broadcaster_map_to_base_link&quot;</span>);</span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line">	ros::Subscriber sub = node.<span class="built_in">subscribe</span>(<span class="string">&quot;/mavros/local_position/pose&quot;</span>, <span class="number">10</span>, &amp;poseCallback);</span><br><span class="line">	ros::<span class="built_in">spin</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后可以打开一个rviz订阅两个坐标系，接着让飞机起飞，观察是否和现实相符合</p>
<blockquote>
<p>在mavros中也提供了一个很方便的接口，在启动gazebo的launch中最后加入下面几行和上面的效果是一样的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;/mavros/local_position/tf/frame_id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;str&quot;</span> <span class="attr">value</span>=<span class="string">&quot;map&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;/mavros/local_position/tf/child_frame_id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;str&quot;</span> <span class="attr">value</span>=<span class="string">&quot;base_link&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;/mavros/local_position/tf/send&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bool&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="多机通信"><a href="#多机通信" class="headerlink" title="多机通信"></a>多机通信</h1><blockquote>
<p>该方法可以实现在一台电脑（从机）上订阅另外一台电脑（主机）里的ros话题（需在局域网下）</p>
</blockquote>
<ul>
<li><p>输入<code>ifconfig</code>查看本机ip地址</p>
</li>
<li><p>把下面的内容写入.bashrc中，两台电脑中的<code>ROS_MASTER_URI</code>里的ip地址填<strong>主机</strong>的ip，<code>ROS_IP</code>就填自己的ip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ROS_MASTER_URI=http://192.168.1.113:11311</span><br><span class="line"><span class="built_in">export</span> ROS_IP=192.168.1.108</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
      
      
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/ros/" rel="tag">ros</a></li></ul>


    </footer>
  </div>
  
    
  <nav id="article-nav" data-aos="fade-up">
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="/covers/tg_12.jpg" data-sizes="auto" alt="ubuntu20.04安装PX4" class="lazyload">
          
        
        <a href="/2022/11/20/07.px4-autopilot/"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
          
            ubuntu20.04安装PX4
          
        </h3>
      </div>
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="/covers/tg_10.jpg" data-sizes="auto" alt="ubuntu使用" class="lazyload">
        
      
      <a href="/2022/10/10/05.ubuntu/"></a>
      <div class="article-nav-caption">后一篇</div>
      <h3 class="article-nav-title">
        
          ubuntu使用
        
      </h3>
    </div>
    
  </nav>


  
</article>





  <div id="comments" class="gscomment giscus" data-aos="fade-up"></div>


</section>
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFros"><span class="toc-number">2.</span> <span class="toc-text">什么是ros</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="toc-number">3.</span> <span class="toc-text">在命令行中进行话题通信</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8c-%E5%AE%9E%E7%8E%B0%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="toc-number">4.</span> <span class="toc-text">用c++实现话题通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">4.1.</span> <span class="toc-text">1、准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%BA%90%E7%A0%81%E4%B9%A6%E5%86%99"><span class="toc-number">4.2.</span> <span class="toc-text">2、源码书写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%BC%96%E8%AF%91%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4"><span class="toc-number">4.3.</span> <span class="toc-text">3、编译工作空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%BF%90%E8%A1%8C"><span class="toc-number">4.4.</span> <span class="toc-text">4、运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81launch%E6%96%87%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">5、launch文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tf%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.</span> <span class="toc-text">tf坐标转换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1"><span class="toc-number">6.</span> <span class="toc-text">多机通信</span></a></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="qllokirin" class="lazyload">
  <div class="sidebar-author-name">qllokirin</div>
  <div class="sidebar-description">~\(≧▽≦)/~</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">27</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">5</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">31</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>
</div>
      
      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
</aside>

          
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      2020-2024
      <span class="footer-info-sep"></span>
      qllokirin
    </div>
    
      <div>
        基于&nbsp;<a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="noopener" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        45.6k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        02:45
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">总访客量&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        <div class="sidebar-top">
          <img src="/images/taichi.png" height="50" width="50" alt="backtop" />
          <div class="arrow-up"></div>
        </div>
        <div id="mask"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFros"><span class="toc-number">2.</span> <span class="toc-text">什么是ros</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="toc-number">3.</span> <span class="toc-text">在命令行中进行话题通信</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8c-%E5%AE%9E%E7%8E%B0%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="toc-number">4.</span> <span class="toc-text">用c++实现话题通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">4.1.</span> <span class="toc-text">1、准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%BA%90%E7%A0%81%E4%B9%A6%E5%86%99"><span class="toc-number">4.2.</span> <span class="toc-text">2、源码书写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%BC%96%E8%AF%91%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4"><span class="toc-number">4.3.</span> <span class="toc-text">3、编译工作空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%BF%90%E8%A1%8C"><span class="toc-number">4.4.</span> <span class="toc-text">4、运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81launch%E6%96%87%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">5、launch文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tf%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.</span> <span class="toc-text">tf坐标转换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1"><span class="toc-number">6.</span> <span class="toc-text">多机通信</span></a></li></ol>
      
  </div>
</div>
</div>
      <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="qllokirin" class="lazyload">
  <div class="sidebar-author-name">qllokirin</div>
  <div class="sidebar-description">~\(≧▽≦)/~</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">27</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">5</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">31</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">首页</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">归档</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">关于</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">友链</div>
    </div>
  
</div>
</div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png"/>
        </div>
      </div>
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"></script>



<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>


<script type="module" data-pjax>
  import PhotoSwipeLightbox from "https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js";
  
  const pswp = () => {
    if (_$$('.article-entry a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-entry',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    if(_$$('.article-gallery a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-gallery',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    window.lightboxStatus = 'done';
    window.removeEventListener('lightbox:ready', pswp);
  }
  if(window.lightboxStatus === 'ready') {
    pswp()
  } else {
    window.addEventListener('lightbox:ready', pswp);
  }
</script>










  <script data-pjax>
    var giscusContainer = document.querySelector('.giscus');
    if (giscusContainer) {
      const giscusScript = document.createElement('script');
      giscusScript.src = 'https://giscus.app/client.js';
      giscusScript.setAttribute('data-repo', 'qllokirin/hexo_blog_comments');
      giscusScript.setAttribute('data-repo-id', 'R_kgDOI8fvWA');
      giscusScript.setAttribute('data-category', 'Announcements'); 
      giscusScript.setAttribute('data-category-id', 'DIC_kwDOI8fvWM4CUIlh');
      giscusScript.setAttribute('data-mapping', '0');
      giscusScript.setAttribute('data-strict', '0');
      giscusScript.setAttribute('data-reactions-enabled', '1');
      giscusScript.setAttribute('data-emit-metadata', '0');
      giscusScript.setAttribute('data-input-position', 'bottom');
      giscusScript.setAttribute('data-theme', 'preferred_color_scheme');
      giscusScript.setAttribute('data-lang', 'zh-CN');
      giscusScript.setAttribute('crossorigin', 'anonymous');
      giscusScript.async = true;
      giscusContainer.appendChild(giscusScript);
    }
  </script>



  
<script src="/js/generator_search.js" defer></script>






  
<script src="https://npm.webcache.cn/mouse-firework@0.0.4/dist/index.umd.js"></script>

  <script>
    window.firework && window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["#66ccff","#99e0ff","#ccefff","#e6f7ff"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["#0099cc"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>







  
<script src="https://npm.webcache.cn/quicklink@2.3.0/dist/quicklink.umd.js"></script>

  <script data-pjax>
    window.quicklink?.listen({
      timeout: 3000,
      priority: true,
      ignores: []
    });
  </script>


<div id="lazy-script">
  <div>
    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #66ccff;')
    console.log('%c Theme.Reimu v' + '0.3.3' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #66ccff; padding:5px 0;', 'padding:4px;border:1px solid #66ccff;')
  </script>
  



  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>

  <!-- hexo injector body_end start -->
<script src="/js/insert_highlight.js" data-pjax></script>
<!-- hexo injector body_end end --></body>
  </html>

